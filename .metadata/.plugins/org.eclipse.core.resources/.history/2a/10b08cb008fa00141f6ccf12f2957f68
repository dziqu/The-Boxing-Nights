package Inne;

import static Inne.IO.drukuj;

import java.awt.Dimension;
import java.awt.DisplayMode;
import java.awt.GraphicsDevice;
import java.awt.GraphicsEnvironment;
import java.awt.Toolkit;
import java.io.File;
import java.math.BigInteger;
import java.util.List;
import java.util.prefs.BackingStoreException;

import Enumy.EBuforSzablonowy;
import Enumy.EG³êbiaKolorów;
import Enumy.ENazwy;
import Enumy.EMultipróbkowanie;
import Enumy.ERenderery;
import Interfejsy.IUstawienia;

import com.jme3.app.SimpleApplication;
import com.jme3.system.AppSettings;

/**
 * Klasa ustawia ustawienia wyœwietlania.
 */
public class Ustawienia implements IUstawienia {
	
	private SimpleApplication app;
	private AppSettings ustawienia;
	private List <String> listaUstawieñWyœwietlania;
	
	/**
	 * Konstruktor domyœlny.
	 */
	public Ustawienia(SimpleApplication app) {
		ustawInstancjêKlasySimpleApplication(app);
		ustawInstancjêKlasyAppSettings(new AppSettings(true)); }
	
	@Override
	public void ustawInstancjêKlasySimpleApplication(SimpleApplication app) { this.app = app; }
	
	@Override
	public SimpleApplication zwróæInstancjêKlasySimpleApplication() { return app; }
	
	/**
	 * Ustawia instancjê klasy AppSettings.
	 * @param ustawienia instancja klasy AppSettings
	 */
	@Override
	public void ustawInstancjêKlasyAppSettings(AppSettings ustawienia) { this.ustawienia = ustawienia; }
	
	/**
	 * Zwraca instancjê klasy AppSettings.
	 * @return instancja klasy AppSettings
	 */
	@Override
	public AppSettings zwróæInstancjêKlasyAppSettings() { return ustawienia; }
	
	@Override
	public void inicjujUstawieniaPocz¹tkowe() {
		File plik = new File(ENazwy.PLIK_PRZECHOWUJ¥CY_LICZBÊ_URUCHOMIEÑ_PROGRAMU.zwróæLokalizacjê());
		Boolean nieZnalezionoPlikuUstawieñ = !IO.istniejePlik(plik);
		if (nieZnalezionoPlikuUstawieñ) {
			IO.drukuj(plik);
		} 
		BigInteger liczbaUruchomieñProgramu = Iteracje.inkrementujLiczbêUruchomieñProgramu();
		Boolean programZosta³UruchomionyPierwszyRaz = Porównania.porównaj(liczbaUruchomieñProgramu, BigInteger.ONE) == 0;
		if (programZosta³UruchomionyPierwszyRaz) {
			pobierzUstawieniaDomyœlneZSystemu();
		}
		ustawEkranDialogowy(false);
		wczytaj(ENazwy.PLIK_USTAWIEÑ_WYŒWIETLANIA.zwróæLokalizacjê());
		ustawUstawienia();
	}
	
	private void pobierzUstawieniaDomyœlneZSystemu() {
		GraphicsDevice urz¹dzenie = GraphicsEnvironment.getLocalGraphicsEnvironment().getDefaultScreenDevice();
		DisplayMode[] trybyWyœwietlania = urz¹dzenie.getDisplayModes();
		int numerWybranegoUrz¹dzenia = 0;
		int rozmiarTablicyPrzechowuj¹cejTrybyWyœwietlania = trybyWyœwietlania.length;
		if (rozmiarTablicyPrzechowuj¹cejTrybyWyœwietlania > 0) {
			DisplayMode trybWyœwietlania = trybyWyœwietlania[numerWybranegoUrz¹dzenia];
			ustawRenderer(ERenderery.OpenGL2);
			ustawG³êbiêKolorów(EG³êbiaKolorów.BPP32);
			ustawIloœæKlatek(60);
			ustawTrybPe³negoEkranu(false);
			Dimension rozdzielczoœæEkranu = Toolkit.getDefaultToolkit().getScreenSize();
			int wysokoœæ = (int) rozdzielczoœæEkranu.getHeight();
			int szerokoœæ = (int) rozdzielczoœæEkranu.getWidth();
			ustawRozdzielczoœæ(szerokoœæ, wysokoœæ);
			ustawMultipróbkowanie(EMultipróbkowanie.PRÓBEK_4);
			ustawSynchronizacjêPionow¹(false);
			zapisz(ENazwy.PLIK_USTAWIEÑ_WYŒWIETLANIA.zwróæLokalizacjê());
		}
	}
	
	@Override
	public void ustawEkranDialogowy(Boolean czyWyœwietliæEkranDialogowy) {
		zwróæInstancjêKlasySimpleApplication().setShowSettings(czyWyœwietliæEkranDialogowy);
	}
	
	/**
	 * Ustawia renderer.
	 * @param rodzajRenderera rodzaj renderera
	 */
	@Override
	public void ustawRenderer(ERenderery rodzajRenderera) { 
		zwróæInstancjêKlasyAppSettings().setRenderer(rodzajRenderera.zwróæRenderer()); }
	
	/**
	 * Ustawia g³êbiê kolorów.
	 * @param g³êbiaKolorów g³êbiaKolorów
	 */
	@Override
	public void ustawG³êbiêKolorów(EG³êbiaKolorów g³êbiaKolorów) { 
		zwróæInstancjêKlasyAppSettings().setBitsPerPixel(g³êbiaKolorów.zwróæIloœæBitówNaPiksel()); }
	
	/**
	 * Ustawia iloœæ klatek.
	 * @param iloœæKlatek iloœæ klatek
	 */
	@Override
	public void ustawIloœæKlatek(Integer iloœæKlatek) {
		zwróæInstancjêKlasyAppSettings().setFrameRate(iloœæKlatek); }
	
	/**
	 * Ustawia tryb pe³nego ekranu.
	 * @param czyUstawiæTrybPe³negoEkranu czy ustawiæ tryb pe³nego ektanu
	 */
	@Override
	public void ustawTrybPe³negoEkranu(Boolean czyUstawiæTrybPe³negoEkranu) {
		zwróæInstancjêKlasyAppSettings().setFullscreen(czyUstawiæTrybPe³negoEkranu); }
	
	/**
	 * Ustawia szerokoœæ.
	 * @param szerokoœæ szerokoœæ
	 */
	@Override
	public void ustawSzerokoœæ(Integer szerokoœæ) {
		zwróæInstancjêKlasyAppSettings().setWidth(szerokoœæ); }
	
	/**
	 * Ustawia wysokoœæ.
	 * @param wysokoœæ wysokoœæ
	 */
	@Override
	public void ustawWysokoœæ(Integer wysokoœæ) {	
		zwróæInstancjêKlasyAppSettings().setHeight(wysokoœæ); }
	
	/**
	 * Ustawia rozdzielczoœæ.
	 * @param szerokoœæ szerokoœæ
	 * @param wysokoœæ wysokoœæ
	 */
	@Override
	public void ustawRozdzielczoœæ(Integer szerokoœæ, Integer wysokoœæ) {
		zwróæInstancjêKlasyAppSettings().setResolution(szerokoœæ, wysokoœæ); }
	
	/**
	 * Ustawia multipróbkowanie.
	 * @param multipróbkowanie multipróbkowanie
	 */
	@Override
	public void ustawMultipróbkowanie(EMultipróbkowanie multipróbkowanie) {
		zwróæInstancjêKlasyAppSettings().setSamples(multipróbkowanie.zwróæIloœæPróbek()); }
	
	/**
	 * Ustawia synchronizacjê pionow¹.
	 * @param czyUstawiæSynchronizacjêPionow¹ czy ustawiæ synchronizacjê pionow¹
	 */
	@Override
	public void ustawSynchronizacjêPionow¹(Boolean czyUstawiæSynchronizacjêPionow¹) {
		zwróæInstancjêKlasyAppSettings().setVSync(czyUstawiæSynchronizacjêPionow¹); }
	
	/**
	 * Ustawia czêstotliwoœæ.
	 * @param czêstotliwoœæ czêstotliwoœæ
	 */
	@Override
	public void ustawCzêstotliwoœæ(Integer czêstotliwoœæ) { 
		zwróæInstancjêKlasyAppSettings().setFrequency(czêstotliwoœæ); }
	
	/**
	 * Ustawia bufor szablonowy
	 * @param buforSzablonowy bufor szablonowy
	 */
	@Override
	public void ustawBuforSzablonowy(EBuforSzablonowy buforSzablonowy) {
		zwróæInstancjêKlasyAppSettings().setBitsPerPixel(buforSzablonowy.zwróæLiczbêBitówMatrycy()); }

	@Override
	public void zapisz(String nazwa) { 
		try { zwróæInstancjêKlasyAppSettings().save(nazwa); } 
		catch (BackingStoreException e) { e.printStackTrace(); } }

	@Override
	public void wczytaj(String nazwa) { 
		try { zwróæInstancjêKlasyAppSettings().load(nazwa); } 
		catch (BackingStoreException e) { e.printStackTrace(); } }
	
	@Override
	public void ustawUstawienia() {
		zwróæInstancjêKlasySimpleApplication().setSettings(zwróæInstancjêKlasyAppSettings());
	}
	
	private void ustawListêUstawieñWyœwietlania(List<String> listaUstawieñWyœwietlania) {
		this.listaUstawieñWyœwietlania = listaUstawieñWyœwietlania; }
	
	private List <String> zwróæListêUstawieñWyœwietlania() { return listaUstawieñWyœwietlania; }
	
	private Integer zwróæRozmiarListyUstawieñWyœwietlania() { return listaUstawieñWyœwietlania.size(); }
	
	private void stwórzPlikUstawieñ() { drukuj(new File(ENazwy.PLIK_PRZECHOWUJ¥CY_LICZBÊ_URUCHOMIEÑ_PROGRAMU.zwróæLokalizacjê()), ""); }

}
